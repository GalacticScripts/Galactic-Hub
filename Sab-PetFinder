--// Configuration - CHANGE THESE VALUES
getgenv().webhook = "https://discord.com/api/webhooks/1435764712725024799/OUj-TJviyHqusZhZHgzUx92vQx7S7Nv9so9nfjk8BfMfNcwdK7w-wGj1I3puDpY9gka1"

getgenv().TargetPetNames = {
    "Chillin Chili", 
    "Strawberry Elephant", 
    "Los Tacoritas", 
    "La Extinct Grande", 
    "Los 67",
    "Money Money Puggy", 
    "Garama and Madundung", 
    "La Grande Combinasion", 
    "Nuclearo Dinossauro", 
    "Spaghetti Tualetti", 
    "Dragon Cannelloni", 
    "Tralaledon",
    "Ketupat Kepat", 
    "La Supreme Combinasion", 
    "Ketchuru and Musturu", 
    "Los Bros", 
    "67",
    "Los Noo My Hotspotsitos", 
    "Celularcini Viciosini", 
    "Los Combinasionas",
    "Burguro And Fryuro", 
    "Chicleteira Bicicleteira", 
    "Chicleteirina Bicicleteirina",
    "Eviledon", 
    "La Spooky Grande", 
    "Las Sis", 
    "Los Chicleteiras", 
    "Los Hotspotsitos", 
    "Los Mobilis", 
    "Mariachi Corazoni", 
    "Secret Lucky Block", 
    "Tacorita Bicicleta", 
    "Tang Tang Keletang", 
    "Tictac Sahur", 
    "To to to Sahur", 
    "Esok Sekolah", 
    "Spooky and Pumpy", 
    "Noo My Hotspot", 
    "Chipso and Queso", 
    "Mieteteira Bicicleteira", 
    "Headless Horseman",
    "La Taco Combinasion", 
    "La Casa Boo", 
    "Meowl", 
    "Los Primos", 
    "Los Spooky Combanasionias",
    "Noo my examine", 
    "Quesadilla Vampiro", 
    "Burrito Bandito", 
    "La Secret Combinasion", 
    "Horegini Boom", 
    "La Sahur Combinasion", 
    "Pot Pumpkin", 
    "Quesadilla Crocodila",
    "Rang Ring Bus",
    "Noo my Candy",
    "Vulturino Skeletono",
    "Los Tortus",
    "Blackhole Goat",
    "Los Tralaleritos",
    "Guerriro Digitale",
    "La Cucaracha",
    "Las Tralaleritas",
    "Zombie Tralala"
}

--// AUTO-EXECUTION SCRIPT URL
getgenv().ScriptURL = "https://raw.githubusercontent.com/GalacticScripts/Galactic-Hub/refs/heads/main/Sab-PetFinder"

--// SERVER FILTER SETTINGS
getgenv().MinPlayers = 10 -- Only join servers with at least this many players
getgenv().MaxPlayers = 25 -- Maximum players in server (leave room to join)

--// Services
local Players = game:GetService("Players")
local HttpService = game:GetService("HttpService")
local TeleportService = game:GetService("TeleportService")

-- Wait for LocalPlayer
local LocalPlayer
repeat
    LocalPlayer = Players.LocalPlayer
    task.wait()
until LocalPlayer

--// User Configuration
local webhook = getgenv().webhook
local targetPets = getgenv().TargetPetNames
local scriptURL = getgenv().ScriptURL

--// Global Scan Counter (persists across server hops)
if not getgenv().TotalScans then
    getgenv().TotalScans = 0
    getgenv().TotalFinds = 0
    getgenv().StartTime = os.time()
end

--// Visited Job Tracking
local visitedJobIds = {[game.JobId] = true}
local hops = 0
local maxHopsBeforeReset = 50

--// Teleport Fail Handling
local teleportFails = 0
local maxTeleportRetries = 3

--// Found Pet Cache
local detectedPets = {}
local webhookSent = false
local stopHopping = false

--// Multiple Queue Methods for Better Compatibility
local function queueScript()
    local queueCode = [[
        repeat task.wait() until game:IsLoaded()
        task.wait(3)
        local success, err = pcall(function()
            loadstring(game:HttpGet("]] .. scriptURL .. [["))()
        end)
        if not success then
            warn("Failed to load script:", err)
        end
    ]]
    
    -- Try multiple queue methods
    if queue_on_teleport then
        queue_on_teleport(queueCode)
    end
    if syn and syn.queue_on_teleport then
        syn.queue_on_teleport(queueCode)
    end
    if fluxus and fluxus.queue_on_teleport then
        fluxus.queue_on_teleport(queueCode)
    end
end

--// Teleport Fail Handling
TeleportService.TeleportInitFailed:Connect(function(_, result)
    teleportFails += 1
    if result == Enum.TeleportResult.GameFull then
        warn("âš ï¸ Game full. Retrying teleport...")
    elseif result == Enum.TeleportResult.Unauthorized then
        warn("âŒ Unauthorized/private server. Blacklisting and retrying...")
        visitedJobIds[game.JobId] = true
    else
        warn("âŒ Other teleport error:", result)
    end

    if teleportFails >= maxTeleportRetries then
        warn("âš ï¸ Too many teleport fails. Forcing fresh server...")
        teleportFails = 0
        task.wait(1)
        queueScript()
        TeleportService:Teleport(game.PlaceId)
    else
        task.wait(1)
        serverHop()
    end
end)

--// ESP Function
local function addESP(targetModel)
    if targetModel:FindFirstChild("PetESP") then return end
    local Billboard = Instance.new("BillboardGui")
    Billboard.Name = "PetESP"
    Billboard.Adornee = targetModel
    Billboard.Size = UDim2.new(0, 100, 0, 30)
    Billboard.StudsOffset = Vector3.new(0, 3, 0)
    Billboard.AlwaysOnTop = true
    Billboard.Parent = targetModel

    local Label = Instance.new("TextLabel")
    Label.Size = UDim2.new(1, 0, 1, 0)
    Label.BackgroundTransparency = 1
    Label.Text = "ğŸ¯ Target Pet"
    Label.TextColor3 = Color3.fromRGB(255, 0, 0)
    Label.TextStrokeTransparency = 0.5
    Label.Font = Enum.Font.SourceSansBold
    Label.TextScaled = true
    Label.Parent = Billboard
end

--// Webhook Function
local function sendWebhook(foundPets)
    if not webhook or webhook == "https://discord.com/api/webhooks/1435764712725024799/OUj-TJviyHqusZhZHgzUx92vQx7S7Nv9so9nfjk8BfMfNcwdK7w-wGj1I3puDpY9gka1" then
        warn("âš ï¸ Webhook not configured, skipping notification.")
        return
    end

    getgenv().TotalFinds += 1

    local petCounts = {}
    for _, pet in ipairs(foundPets) do
        if pet then
            petCounts[pet] = (petCounts[pet] or 0) + 1
        end
    end

    local formattedPets = {}
    for petName, count in pairs(petCounts) do
        table.insert(formattedPets, count > 1 and petName .. " x" .. count or petName)
    end

    local serverLink = "[Join](https://fern.wtf/joiner?placeId=" .. game.PlaceId .. "&gameInstanceId=" .. game.JobId .. ")"
    
    local runTime = os.time() - getgenv().StartTime
    local hours = math.floor(runTime / 3600)
    local minutes = math.floor((runTime % 3600) / 60)
    local timeStr = hours > 0 and string.format("%dh %dm", hours, minutes) or string.format("%dm", minutes)

    local jsonData = HttpService:JSONEncode({
        ["content"] = "ğŸš¨ SECRET PET DETECTED!",
        ["embeds"] = {{
            ["title"] = #foundPets .. " Secret Pet(s) Found!",
            ["description"] = "Brainrot-worthy pet detected in the server!",
            ["fields"] = {
                { ["name"] = "ğŸ“ Location Info", ["value"] = "`game:GetService('TeleportService'):TeleportToPlaceInstance(" .. game.PlaceId .. ", '" .. game.JobId .. "')`" },
                { ["name"] = "ğŸ‘¥ Players", ["value"] = tostring(#Players:GetPlayers()) },
                { ["name"] = "ğŸ¾ Pets Found", ["value"] = table.concat(formattedPets, "\n") },
                { ["name"] = "ğŸ”— Server Link", ["value"] = serverLink },
                { ["name"] = "ğŸ“Š Stats", ["value"] = "Scans: " .. getgenv().TotalScans .. " | Finds: " .. getgenv().TotalFinds .. " | Runtime: " .. timeStr },
                { ["name"] = "â° Time", ["value"] = os.date("%m/%d/%y, %I:%M %p") }
            },
            ["color"] = 0xFF00FF,
            ["footer"] = {
                ["text"] = "Place ID: " .. game.PlaceId .. " â€¢ " .. game.JobId
            }
        }}
    })

    local req = http_request or request or syn and syn.request
    if req then
        local success, err = pcall(function()
            req({
                Url = webhook,
                Method = "POST",
                Headers = { ["Content-Type"] = "application/json" },
                Body = jsonData
            })
        end)
        if success then
            print("âœ… Webhook sent. Total finds:", getgenv().TotalFinds)
        else
            warn("âŒ Failed to send webhook:", err)
        end
    else
        warn("âŒ Executor doesn't support HTTP requests.")
    end

    -- Wait 5 seconds before hopping to give time to join
    task.wait(5)
    stopHopping = false
    webhookSent = false
    serverHop()
end

--// Strict Target Matching
local function matchesTarget(petName)
    for _, target in ipairs(targetPets) do
        if string.lower(petName) == string.lower(target) then
            return true
        end
    end
    return false
end

--// Check all plots for exact pets
local function checkForPets()
    local found = {}
    if workspace:FindFirstChild("Plots") then
        for _, plot in ipairs(workspace.Plots:GetChildren()) do
            if plot:IsA("Model") then
                for _, obj in ipairs(plot:GetChildren()) do
                    if obj:IsA("Model") and matchesTarget(obj.Name) and not obj:FindFirstChild("PetESP") then
                        addESP(obj)
                        table.insert(found, obj.Name)
                        stopHopping = true
                    end
                end
            end
        end
    end
    return found
end

--// Server Hop Function
function serverHop()
    if stopHopping then return end
    task.wait(1.5)

    local cursor = nil
    local PlaceId, JobId = game.PlaceId, game.JobId
    local tries = 0

    hops += 1
    if hops >= maxHopsBeforeReset then
        visitedJobIds = {[JobId] = true}
        hops = 0
        print("â™»ï¸ Resetting visited JobIds.")
    end

    while tries < 3 do
        local url = "https://games.roblox.com/v1/games/" .. PlaceId .. "/servers/Public?sortOrder=Asc&limit=100"
        if cursor then url = url .. "&cursor=" .. cursor end

        local success, response = pcall(function()
            return HttpService:JSONDecode(game:HttpGet(url))
        end)

        if success and response and response.data then
            local servers = {}
            for _, server in ipairs(response.data) do
                if tonumber(server.playing or 0) < tonumber(server.maxPlayers or 1)
                    and server.id ~= JobId
                    and not visitedJobIds[server.id] then
                        table.insert(servers, server.id)
                end
            end

            if #servers > 0 then
                local picked = servers[math.random(1, #servers)]
                print("âœ… Hopping to server:", picked)
                teleportFails = 0
                
                -- Queue script for next server
                queueScript()
                
                TeleportService:TeleportToPlaceInstance(PlaceId, picked)
                return
            end

            cursor = response.nextPageCursor
            if not cursor then
                tries += 1
                cursor = nil
                task.wait(0.5)
            end
        else
            warn("âš ï¸ Failed to fetch server list. Retrying...")
            tries += 1
            task.wait(0.5)
        end
    end

    warn("âŒ No valid servers found. Forcing random teleport...")
    
    -- Queue script before random teleport
    queueScript()
    
    TeleportService:Teleport(PlaceId)
end

--// Live Detection
workspace.DescendantAdded:Connect(function(obj)
    task.wait(0.25)
    if obj:IsA("Model") and obj.Parent and obj.Parent:IsDescendantOf(workspace.Plots) then
        if matchesTarget(obj.Name) and not obj:FindFirstChild("PetESP") then
            if not detectedPets[obj] then
                detectedPets[obj] = true
                addESP(obj)
                print("ğŸ¯ New pet appeared:", obj.Name)
                stopHopping = true
                if not webhookSent then
                    sendWebhook({obj.Name})
                    webhookSent = true
                end
            end
        end
    end
end)

--// Start
print("ğŸ” Starting Pet Finder...")
print("ğŸ“Š Total scans:", getgenv().TotalScans)
print("ğŸ¯ Total finds:", getgenv().TotalFinds)
print("â±ï¸ Session runtime:", math.floor((os.time() - getgenv().StartTime) / 60) .. " minutes")

task.wait(6)
getgenv().TotalScans += 1

local petsFound = checkForPets()
if #petsFound > 0 then
    for _, name in ipairs(petsFound) do
        detectedPets[name] = true
    end
    if not webhookSent then
        print("ğŸ¯ Found pet(s):", table.concat(petsFound, ", "))
        sendWebhook(petsFound)
        webhookSent = true
    end
else
    print("ğŸ” No target pets found. Hopping to next server...")
    task.delay(1.5, serverHop)
end
